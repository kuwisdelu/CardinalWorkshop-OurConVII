search()
ls()
mse
library(Cardinal)
register(SerialParam())
url <- "https://ms-imaging.org/wp/wp-content/uploads/2019/03/S043_Processed_imzML1.1.1.zip"
tmpfile <- tempfile()
tmpdir <- tempdir()
download.file(url, destfile=tmpfile)
unzip(tmpfile, exdir=tmpdir)
file <- grep(".imzML", list.files(tmpdir), value=TRUE)
file <- file.path(tmpdir, file)
file
mse <- readMSIData(file, resolution=0.05, units="mz")
mse
mse_mean <- summarize(mse, .stat="mean")
plot(mse_mean)
mse_tic <- summarize(mse, .stat=c(tic="sum"), .by="pixel")
image(mse_tic)
data(rcc, package="CardinalWorkflows")
rcc <- as(rcc, "MSImagingExperiment")
rcc
rcc_mean <- summarize(rcc, .stat="mean")
rcc_ref <- rcc_mean %>%
peakPick(SNR=3) %>%
peakAlign(ref="mean",
tolerance=0.5,
units="mz") %>%
peakFilter() %>%
process()
rcc_peaks <- rcc %>%
normalize(method="tic") %>%
peakBin(ref=mz(rcc_ref),
tolerance=0.5,
units="mz") %>%
process()
rcc_peaks
rcc_peaks <- rcc %>%
normalize(method="tic") %>%
peakBin(ref=mz(rcc_ref),
tolerance=0.5,
units="mz") %>%
process()
rcc_peaks
image(rcc_peaks, mz=810)
rcc_peaks$rough_diagnosis <- factor("normal", level=c("normal", "cancer"))
rcc_peaks
pData(rcc_peaks)
nlevels(run(rcc_peaks))
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
rcc_peaks$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff] <- "cancer"
}
xcutoff<-c(35, 23, 28, 39, 29, 28, 44, 32)
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
rcc_peaks$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff] <- "cancer"
}
pData(rcc_peaks)
image(rcc_peaks, rough_diagnosis ~ x * y, layout=c(4,2))
rcc_peaks$rough_diagnosis <- factor("normal", level=c("normal", "cancer"))
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
rcc_peaks$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff] <- "cancer"
}
image(rcc_peaks, rough_diagnosis ~ x * y, layout=c(4,2))
image(rcc_peaks, diagnosis ~ x * y, layout=c(4,2))
runNames(rcc_peaks)
i <- 1
rcc_peaks$rough_diagnosis <- factor("normal", level=c("normal", "cancer"))
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
cur_run
coord(rcc_peaks)$x
coord(rcc_peaks)$x < xcutoff
cur_run & coord(rcc_peaks)$x < xcutoff
rcc_peaks$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff] <- "cancer"
image(rcc_peaks, rough_diagnosis ~ x * y, layout=c(4,2))
rcc_peaks$rough_diagnosis <- factor("normal", level=c("normal", "cancer"))
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
pData(rcc_peaks)$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff] <- "cancer"
}
image(rcc_peaks, rough_diagnosis ~ x * y, layout=c(4,2))
i
i <- 1
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
xcutoff<-c(35, 23, 28, 39, 29, 28, 44, 32)
rcc_peaks$rough_diagnosis <- factor("normal", level=c("normal", "cancer"))
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
pData(rcc_peaks)$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff[i]] <- "cancer"
}
image(rcc_peaks, rough_diagnosis ~ x * y, layout=c(4,2))
image(rcc_peaks, mz=810, groups=rough_diagnosis, layout=c(4,2))
image(rcc_peaks, mz=810, groups=rough_diagnosis,
contrast.enhance="histogram", layout=c(4,2))
xcutoff<-c(35, 23, 28, 39, 29, 28, 44, 32)
rcc_peaks$rough_diagnosis <- factor("normal", level=c("cancer", "normal"))
for ( i in 1:nlevels(run(rcc_peaks)) ) {
cur_run <- run(rcc_peaks) == runNames(rcc_peaks)[i]
pData(rcc_peaks)$rough_diagnosis[cur_run & coord(rcc_peaks)$x < xcutoff[i]] <- "cancer"
}
image(rcc_peaks, mz=810, groups=rough_diagnosis,
contrast.enhance="histogram", layout=c(4,2))
rcc_var <- summmarize(rcc_peaks, .stat="var")
rcc_var <- summarize(rcc_peaks, .stat="var")
plot(rcc_var)
rcc_var <- summarize(rcc_peaks, .stat="var", .as="DataFrame")
plot(rcc_var, var ~ mz)
rcc_var <- summarize(rcc_peaks, .stat="var", .as="DataFrame")
plot(rcc_var, var ~ mz)
plot(rcc_var, var ~ mz, main="Variance")
plot(rcc_var, var ~ mz, main="variance")
rcc_var$var
quantile(rcc_var$var, 0.8)
rcc_var$var > quantile(rcc_var$var, 0.8)
rcc_peaks2 <- rcc_peaks[rcc_var$var > quantile(rcc_var$var, 0.8),]
rcc_peaks2
features(rcc_peaks2)
mz(rcc_peaks2)
features(rcc_peaks2, mz=885)
image(rcc_peaks2, mz=885)
rcc_dgmm1 <- spatialDGMM(rcc_peaks2, feature=16, r=1, k=4)
?spatialDGMM
rcc_dgmm1 <- spatialDGMM(rcc_peaks2[16,], r=1, k=4)
image(rcc_dgmm1)
rcc_dgmm1 <- spatialDGMM(rcc_peaks2[16,], r=1, k=4, groups=1)
image(rcc_dgmm1)
summary(rcc_dgmm1)
rcc_peaks$groups <- interaction(run(rcc_peaks), rcc_peaks$rough_diagnosis)
rcc_peaks
pData(rcc_peaks)
rcc_peaks2 <- rcc_peaks[rcc_var$var > quantile(rcc_var$var, 0.8),]
rcc_peaks2
rcc_dgmm <- spatialDGMM(rcc_peaks2, r=1, k=4, groups=rcc_peaks2$groups)
summary(rcc_dgmm)
mtest <- meansTest(rcc_peaks2, ~ rough_diagnosis, groups=rcc_peaks2$groups)
mtest
summary(mtest)
stest<-segmentationTest(rcc_dgmm, ~ diagnosis, classControl = "Mscore")
summary(stest)
stest <- segmentationTest(rcc_dgmm, ~ diagnosis, classControl = "Ymax")
summary(stest)
topFeatures(stest, p.adjust="fdr", AdjP < .05)
image(rcc_peaks2, mz=325)
image(rcc_peaks2, mz=325, contrast.enhance="histogram")
stest <- segmentationTest(rcc_dgmm, ~ rough_diagnosis, classControl = "Mscore")
summary(stest)
stest <- segmentationTest(rcc_dgmm, ~ rough_diagnosis, classControl = "Ymax")
summary(stest)
stest <- segmentationTest(rcc_dgmm, ~ rough_diagnosis, classControl = "Mscore")
summary(stest)
stest <- segmentationTest(rcc_dgmm, ~ rough_diagnosis)
summary(stest)
topFeatures(stest, p.adjust="fdr", AdjP < .05)
image(rcc_peaks2, mz=885, contrast.enhance="histogram")
plot(stest, model=list(feature=16))
plot(stest, model=list(feature=1))
plot(stest, model=list(feature=16))
stest <- segmentationTest(rcc_dgmm, ~ rough_diagnosis)
summary(stest)
summary(stest)
summary(mtest)
summary(mtest)
topFeatures(stest, p.adjust="fdr", AdjP < .05)
plot(stest, model=list(feature=16))
image(rcc_peaks2, mz=885, contrast.enhance="histogram")
plot(stest, model=list(feature=16))
image(rcc_peaks2, mz=885, contrast.enhance="histogram")
image(rcc_peaks2, mz=885, contrast.enhance="histogram", layout=c(4,2))
image(rcc_peaks2, mz=885,layout=c(4,2),
contrast.enhance="histogram",
normalize.image="linear")
image(rcc_peaks2, mz=885,layout=c(4,2),
contrast.enhance="suppress",
normalize.image="linear")
plot(stest, model=list(feature=16, 17))
plot(stest, model=list(feature=16, 17))
plot(stest, model=list(feature=16))
topFeatures(stest, p.adjust="fdr", AdjP < .05)
rcc_peaks2 <- rcc_peaks[rcc_var$var >= quantile(rcc_var$var, 0.8),]
rcc_peaks2
image(rcc_dgmm1)
summary(mtest)
topFeatures(mtest, p.adjust="fdr", AdjP < .05)
topFeatures(mtest, p.adjust="fdr", AdjP < .05)
topFeatures(stest, p.adjust="fdr", AdjP < .05)
